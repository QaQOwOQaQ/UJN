# 一、SQL

## 1. 数据库操作

### 创建数据库

```sql
CREATE DATABASE `NAME`;
CREATE DATABASE IF NOT EXISTS `NAME`;
```

注意事项：

1. 正确拼写"database"
2. IF NOT EXISTS 必须放在数据库名前
3. 使用反引号``避免与关键字冲突

### 删除数据库

```sql
DROP DATABASE `NAME`;
```

## 2. 数据类型

### 数值类型

- 严格数值类型：INTEGER、SMALLINT、DECIMAL、NUMERIC
- 近似数值类型：FLOAT、REAL、DOUBLE PRECISION
- INT是INTEGER的同义词，DEC是DECIMAL的同义词
- FLOAT占用4或8字节，取决于小数位数

### 日期时间类型

- 每个时间类型有有效值范围和"零"值
- TIMESTAMP有自动更新特性
- DATETIME和TIMESTAMP区别：
  1. 存储方式不同
  2. 时间范围不同
  3. TIMESTAMP有自动初始化和更新功能

### 字符串类型

#### CHAR vs VARCHAR

1. CHAR长度固定，VARCHAR长度可变
2. CHAR存取速度更快，但占用更多空间
3. 存储方式不同
4. 都存储非unicode字符数据

## 3. 数据表操作

### 创建表

```sql
CREATE TABLE table_name (
    column_name column_type,
    PRIMARY KEY (column_name),
    CONSTRAINT fk_name FOREIGN KEY (col) REFERENCES other_table(id),
    ENGINE=INNODB DEFAULT CHARSET=UTF8
);
```

注意事项：

- 主键可以单列或多列
- 外键约束需确保数据类型完全一致
- 常用列级约束：NOT NULL、UNIQUE、PRIMARY KEY

### 删除表

```sql
DROP TABLE table_name;
```

### 插入数据

```sql
-- 单条插入
INSERT INTO table_name (col1, col2) VALUES (val1, val2);

-- 多条插入
INSERT INTO table_name (col1, col2) 
VALUES (valA1, valA2), (valB1, valB2), (valC1, valC2);
```

## 4. 数据查询

### 基本检索

```sql
SELECT DISTINCT col1, col2 
FROM table_name
WHERE condition
ORDER BY col1 DESC, col2
LIMIT 10 OFFSET 5;
```

特点：

- DISTINCT去重
- LIMIT限制行数，OFFSET设置偏移量
- ORDER BY排序，DESC降序，ASC升序

### 过滤数据

```sql
SELECT * FROM table_name
WHERE col1 = 'value' 
  AND (col2 > 100 OR col3 IS NOT NULL)
  AND col4 IN ('A', 'B', 'C')
  AND col5 LIKE 'abc%';
```

运算符：

- BETWEEN AND、IS NULL、<>、!<、!>
- AND优先级高于OR
- IN相当于多个OR
- LIKE支持通配符：%任意多个字符，_单个字符

### 函数

```sql
-- 文本函数
SELECT UPPER(name), LENGTH(description) 
FROM products;

-- 数值函数
SELECT ABS(price), SQRT(quantity) 
FROM orders;

-- 聚集函数
SELECT AVG(DISTINCT price), COUNT(*) 
FROM products;
```

### 分组

```sql
SELECT department, COUNT(*) as emp_count
FROM employees
WHERE hire_date > '2020-01-01'
GROUP BY department
HAVING COUNT(*) > 5;
```

注意：

- WHERE在分组前过滤，HAVING在分组后过滤
- GROUP BY不能使用别名

## 5. 高级查询

### 子查询

```sql
SELECT cust_name, 
       (SELECT COUNT(*) 
        FROM orders 
        WHERE customers.id = orders.cust_id) AS order_count
FROM customers;
```

### 联结

```sql
-- 内连接
SELECT a.col1, b.col2
FROM table1 a INNER JOIN table2 b ON a.id = b.id;

-- 外连接
SELECT a.col1, b.col2
FROM table1 a LEFT JOIN table2 b ON a.id = b.id;

-- 自连接
SELECT e1.name, e2.name as manager
FROM employees e1 JOIN employees e2 ON e1.manager_id = e2.id;
```

### 组合查询

```sql
SELECT col1 FROM table1 WHERE condition1
UNION
SELECT col1 FROM table2 WHERE condition2
ORDER BY col1;
```

## 6. 数据操作

### 更新数据

```sql
UPDATE table_name
SET col1 = value1, col2 = value2
WHERE condition;
```

### 删除数据

```sql
-- 删除行
DELETE FROM table_name WHERE condition;

-- 删除列值
UPDATE table_name SET column_name = NULL WHERE condition;
```

### 表复制

```sql
CREATE TABLE new_table AS SELECT * FROM old_table;
```

# 二、数据库系统基础

## English

- **cascade**：级联
- **decimal**：十进制(带小数)
- **cluster**：集群
- **ascending**：升序
- **descending**：降序
- **assertion**：断言
- **trigger**：触发
- **privilege**：权限
- **grant**：授予
- **revoke**：撤销，废除
- **schema**：模式
- **audit**：审计
- **discretion**：自主决定权
- **mandate**：强制执行
- **cursor**：游标
- **compile**：编译
- **transaction**：事务
- **atomicity**：原子性
- **consistency**：一致性
- **isolation**：隔离性
- **durability**：持续性
- **property**：属性，(财产)

------

## 1、记录和字段的区别

简要：字段是列，记录是行。

在关系型数据库中，表就是一个数据的集合体，简单地理解就是一个二维（行与列有简单对应关系的）数据表格。

- **字段**：是指表格中的列，即具有相同属性的数据集合，每个字段都必须有一个唯一的名称，称为字段名。例如，在表格中，如果用一列存放“性别”，“性别”就是一个字段名。
- **记录**：是指表格中的行，它由若干个字段值构成。例如，用于记录每个成员的表中，可以有昵称、年龄、性别、电子邮件等字段，添加进表中的每一个成员，都包含有昵称、年龄、性别、电子邮件这些数据，每个成员的这些数据构成一条记录。

------

## 2、SQL数据集的基本功能

1. **数据查询语言**：通过选择、投影和等值连接运算完成。
2. **数据操纵语言**： 主要包括以下3个方面：
   - 向表中添加新的记录：`INSERT`。
   - 对表中已有数据进行修改：`UPDATE`。
   - 删除表中的记录：`DELETE`。 对数据库中的对象和数据运行访问（可以理解为对表中元素进行操作）。
3. **数据定义语言**： 通过数据定义语言实现，它用来定义数据的逻辑结构，包括定义基表、视图、索引等。基本的DDL包括三类：定义、修改、删除，分别对应 `CREATE`、`ALTER`、`DROP` 三条语句。
4. **数据控制功能**： 数据库的控制是指数据库的安全性和完整性的控制。

------

## 3、SQL是一个非过程化的语言

因为它一次处理一个记录，对数据提供自动导航。

1. 这里的非过程化指的并不是编程语言里面的那个面向过程，而是数据库的Data Manipulation Language(DML)这类语言的一个分类。DML分为两个大类：声明式（Declarative DMLs）和过程式（Procedural DMLs）。
   - 前者我们也称为非过程式的DML（Non-procedural DMLs）。
   - 后者不仅需要声明需要什么样的数据，而且需要给出如何得到数据的方法。
2. SQL“非过程化”指的是在使用其进行数据操作时，SQL的操作过程由DBMS自动完成。用户只需提出“做什么”，而不必知道“怎么做”，无需了解存取路径等。所以称其为非过程化语言。
3. 还可以理解为：越接近硬件底层的越过程化，因为你要“教”机器怎么做。SQL语言则是较高层次的，用户只要告诉数据库管理系统需要的数据，它会自己处理。
4. 大佬的个人理解：非过程化其实就是不需要你告诉数据库管理系统怎么做，它们会自动处理。

------

## 4、不能用比较运算符（>, <, !=, ==）与NULL比较

因为NULL是空值，是一个不确定的值。

------

## 5、视图最终是定义在基本表之上的，对视图的一切操作最终也要转换为对基本表的操作

视图的好处：

- 视图能够简化用户的操作。
- 视图是用户能以多种角度看待同一数据。
- 视图对重构数据库提供了一定程度的逻辑独立性。
- 视图能够对机密数据提供安全保护。

------

## 6、数据库三级模式

- **模式**：对应基本表
- **外模式**：对应视图
- **内模式**：用于存储文件

------

## 7、在视图上不能完成的操作是（ ）?

A. 更新视图
 B. 查询
 C. 在视图上定义新的表
 D. 在视图上定义新的视图

解析： 视图是由从数据库的基本表中选取出来的数据组成的逻辑窗口，它不同于基本表，它是一个虚拟表，其内容由查询定义。数据库中存放的只是视图的定义，而不存放数据，数据仍然存放在原来的基本表结构中。只有在使用视图的时候，才会执行视图的定义，从基本表中查询数据。

- **答案**：C

热评： 视图是基于数据表的一种查询窗口，不能在查询窗口中再建数据表，就像你可以在房子上开窗，但不能在窗子上盖房子。

------

## 8. 五个基本的关系代数运算

关系代数运算是以**集合操作**为基础的运算，其五种基本运算是**并、差、选择、投影和笛卡尔积**。其他的：交，连接，除。

一些操作的解释：

1. **投影**：从一个关系R中选取所需要的列组成一个新关系。
2. **连接**：连接是从两个关系的笛卡尔积中选取属性满足一定条件的元组，连接操作是由笛卡尔积和选择操作组合而成。
3. **除运算**：$R \div X = T$ ：T中包含所有在R但不在S的属性和值，且T的元组与S的元组的所有组合都在R中。简而言之，$R \div X$ 的结果中，列为包含在R中但不在S中的列，行则是R与S的公共行。

------

## 9. 数据模型

通常由 **数据结构**、**数据操作** 和 **数据的完整性约束条件** 三部分组成。

------

## 10. 选择、投影，复制

- **选择**：选出行的某一些。
- **投影**：选择列的某一些。
- **复制**：查询出来的表仅仅是一个虚表，不存在的表。

------

## 11. 模式

**创建模式就相当于创建了数据库的一个命名空间**。

模式（schema）是数据库体系结构中的一个节点，用于在一个大项目中的各个小项目每个小项目的表，放在各自的模式（schema）下面。这样，遇到小项目中有相同名字的表时，**不会发生冲突**。

在学习SQL的过程中，会遇到一个让你迷糊的Schema的概念。实际上，schema就是数据库对象的集合，这个集合包含了各种对象如：表、视图、存储过程、索引等。为了区分不同的集合，就需要给不同的集合起不同的名字，默认情况下一个用户对应一个集合，用户的schema名等于用户名，并作为该用户缺省schema。

------

## 12. 码

码是数据系统中的基本概念。所谓码，就是能唯一标识实体的属性，它是整个实体集的性质，而不是单个实体的性质。它包括超码、候选码、主码。

- **超码**：一个或多个属性的集合，这些属性可以让我们在一个实体集中唯一地标识一个实体。
- **候选码**：是从超码中选出的，它是最小超码。
- **主码**：从多个候选码中选出的用于标识实体的码。

------

## 13. 数据库管理员（DBA）的定义及职责

**数据库管理员（DBA）**是从事管理和维护数据库管理系统的相关人员的统称。

**主要职责**：

1. 决定数据库中的信息内容和结构。
2. 决定数据库的存储结构和存取策略。
3. 定义数据库的安全性要求和完整性约束。
4. 监控数据库的运行和使用。
5. 数据库的改进和重组，甚至重构。

------

## 14. 数据库的安全性和完整性

- **数据的完整性**：是指两个表之间的完整连接，确保数据在逻辑上的一致性、正确性、有效性和相容性。
- **数据的安全性**：是指保护数据库以防止不合法使用所造成的数据泄露、更改或破坏。

这两个概念的相同点是都对数据库中的数据进行控制，不同点在于：安全性关注数据的防护，完整性关注数据的一致性。

------

## 15. 码（续）

### 超码

超码也叫做“超级码”，是一个或多个属性的集合，这些属性可以唯一地标识一个实体。

例如：因为通过 `id` 可以找到唯一一个学生，所以 `{id}` 是一个超码，同理 `{id, student_number}`、`{id, student_number, name}` 等也是超码。

### 候选码

**超码包括候选码**，候选码是最小的超码，它不能包含冗余的属性。

------

## 总结

所有码都是一个集合。所有可以用来在实体集中标识唯一一个实体的集合，都是超码。如果任意超码的真子集不能包括超码，则称其为候选码。被数据库设计者选中的，用来在同一实体集中区分不同实体的候选码就是主码，可以是一个属性或者多个属性的集合。

简单的说，超码包括候选码，候选码包括主码。



# 三、Sqlyog

## 1. 修改表中列的信息

```sql
ALTER TABLE_NAME
CHANGE OLD_COLUMN_NAME NEW_COLUMN_NAME NEWTYPE
```

------

## 2. 指定别名

- **（1）** `old_name AS new_name`
- **（2）** `old_name new_name`

------

## 3. 字符匹配 LIKE

- **（1）** `\' _ \'`：匹配单个字符

- **（2）** `\'%\'`：匹配任意长度字符， 可以为0

- **（3）** 如果要查询的字符包含通配符 `'_'` 或 `'%'`，需要使用转义字符： `ESCAPE <换码字符>`，例如：

  ```sql
  WHERE NAME LIKE 'DB\_DESIGN' ESCAPE \`
  ```

  这样紧跟在 `\` 后面的字符就是普通字符了。

------

## 4. NOT

`NOT` 一般加在谓词的前面，例如：

- `NOT LIKE`
- `NOT BETWEEN AND`
- `NOT IN`
- `NOT NULL`

但一般 `IS` 在 `NOT` 的前面。

------

## 5. A = B

不同于 C 语言，在比较两个数据相等的时候，SQL 使用一个等号，而 C 使用两个等号。

------

## 6. GROUP BY

对查询结果进行分组的目的是为了细化聚集函数的作用对象。如果未对查询结果进行分组，聚集函数的作用对象将是整个查询结果。

------

## 7. 连接查询

有时候查询的数据在多个表上，则需要查询多个表，即连接查询。常见的联合查询有：

- **（1）** 等值连接、自然连接、非等值连接
- **（2）** 外连接
- **（3）** 自身连接
- **（4）** 复合连接

------

## 8. 嵌套查询

子查询不能使用 `ORDER BY` 语句，`ORDER BY` 语句只能用于最终的查询结果。
 子查询的返回是一个集合，因此嵌套查询中最常用的谓词是 `IN`。
 相关子查询需要先处理父查询，不相关子查询需要先处理子查询。

------

## 9. 集合查询

- **（1）** 并集：`UNION`，`UNION` 会自动去除重复行，如果需要显示重复行，使用 `UNION ALL`
- **（2）** 交集：`INTERSECT`
- **（3）** 差集：`EXCEPT`

用法示例：

```sql
SELECT .. FROM .. WHERE .. 
UNION/INTERSECT/EXCEPT
SELECT .. FROM .. WHERE ..
```

------

## 10. 派生表

子查询不仅可以出现在 `WHERE` 子句中，还可以出现在 `FROM` 子句中，在 `FROM` 语句中的子查询的结果集又称为临时**派生表**。
 例如：

```sql
SELECT Sno, Cno, Grade, Grade1 AS avg_Grade
FROM SC, (SELECT Sno, AVG(Grade) FROM SC GROUP BY Sno) AS SC1(Sno1, Grade1)
WHERE SC.Sno = SC1.Sno1
AND SC.Grade > SC1.Grade1;
```

需要说明的是，在 `FROM` 子查询中，必须为返回的结果集指定一个别名，并且可以重新为列名定义别名。

------

## 11. `WHERE` 中不能使用聚集函数

`WHERE` 子句后面不能跟聚集函数，因为聚集函数是对整个列做运算的，使用它的前提是结果集已经确定，而 `WHERE` 是选择满足条件的数据，也就是它还处在确定结果集的过程中。

------

## 12. 视图

对视图的操作最终都会转化为对基本表的操作。

------

## 13. B+树

[B+树解析](https://www.cnblogs.com/lianzhilei/p/11250589.html)

------

## 14. 创建表的时候添加约束

- 在列级定义中，`CONSTRAINT` 后面只能跟 `CHECK`、`NOT NULL` 和 `UNIQUE`，`UNIQUE` 都不合法。
- 在表级定义中，`CONSTRAINT` 后面可以跟 `UNIQUE(NAME)`，但仍然不能跟 `NOT NULL`。
- `NOT NULL` 只能直接添加，不能定义约束名。

------

## 15. 关系实例

关系实例（值）是**关系的“当前”元组的集合**，是动态的、随时间不断变化的，其变化通过关系的元组的改变表现出来。

# 四、复习题

1、数据库系统的核心是（B）
 A.数据库
 B.数据库管理系统
 C.数据模型
 D.软件工具

2、关系系统

> 关系系统可分为(最小)关系系统，完备关系系统，全关系系统
>  （最小）关系系统：仅支持关系数据结构和选择、投影、连接三种关系操作。很多微机上使用的系统如FoxBASE和FoxPro就属于这一类。

结构S(Stmcture)/完整性I(Integrity)/数据操纵M(Malippulation)
 ![IMAGE](https://s1.328888.xyz/2022/06/17/0ASdk.png)

> 表式系统：仅支持关系的数据结构，不支持关系集合级的操作
>  最小关系系统：仅支持关系数据结构和三种关系操作选择、投影、连接
>  关系完备的系统：支持关系数据结构和所有的关系代数操作
>  全关系系统：支持关系模型的所有特征(包括结构和操作)，所以完整性也被满足，目前大多数关系系统已不同程度上接近或达到了这个目标

3、相对于非关系型数据库，关系型数据库的缺点之一是（A）
 A.存储路径对用户透明，需查询优化
 B.数据结构简单
 C.有严格的数学基础
 D.数据独立性高

4、在关系代数中，从两个关系的笛卡尔积中选取他们属性间满足一定条件的元祖的集合，称为（D）
 A.并
 B.选择
 C.自然连接
 D.$Θ$选择

5、如果关系模式R中所有的属性都是主属性，则R的规范化程度至少达到（3NF）

6、在一个关系中，任何候选码中所包含的属性都成为（主属性）

7、主码 属于 候选码 属于 码

8、关系模式分解的等价性标准主要有两个：（无损连接性，保持函数依赖性）

9、数据抽象主要有（聚集）和（分类）两种。

10、并发控制的主要方法是（封锁）机制。

11、故障分为（事务故障、系统故障、介质故障）三种

12、在SQL中，与"NOT IN" 等价的操作符是（A）
 A.<>ALL
 B.<>SOME
 C.=SOME
 D.=ALL

13、事务的定义：事务是用户定义的一个数据库操作序列，这么操作要么全做要么全不做，是一个不可分割的工作单位。

14、关系代数中的 $π$ 运算符对应SELECT语句中的那个字句（A）
 A.SELECT
 B.FROM
 C.GROUP BY
 D.WHERE

15、如果一个1NF范式满足所有关系的属性组合起来是一个关键字，那么关系最高满足的范式是（3NF）

16、E-R图之间的冲突主要有（命名冲突，属性冲突，结构冲突）

17、视图与基本表的区别和联系

> 区别：
>  （1）视图是已经编译好的SQL语句，而表不是
>  （2）视图没有实际的物理记录，而表有。
>  （3）表是内容，视图是窗口
>  （4）表只用物理空间而视图不占用物理空间，视图只是逻辑概念的存在，表可以及时修改，但视图只能用创建的语句来修改
>  （5）表是内模式，视图是外模式
>  （6）视图是查看数据表的一种方法，可以查询数据表中某些字段构成的数据，只是一些SQL语句的集合。从安全的角度说，视图可以不给用户接触数据表，从而不知道表结构。
>  （7）表属于全局模式中的表，是实表；视图属于局部模式的表，是虚表。
>  （8）视图的建立和删除只影响视图本身，不影响对应的基本表

> 联系：视图（view）是在基本表之上建立的表，它的结构（即所定义的列）和内容（即所有数据行）都来自基本表，它依据基本表存在而存在。一个视图可以对应一个基本表，也可以对应多个基本表。视图是基本表的抽象和在逻辑意义上建立的新关系

> （1）视图是从一个或多个基本表导出的表，它与基本表不同，是一个虚表
>  （2）数据库中只存放视图的定义，而不存放视图对应的数据，这些数据存放在原来的基本表当中，当基本表中的数据发生变化，从视图中查询的数据也随之变化
>  （3）视图一经定义就可以像基本表一样被查询、删除，也可以在一个视图上再定义新的视图，但是对视图的更新操作有限制。

18、在数据库模式设计的时候，有时候为了保证性能，不得不牺牲规范化的要求（√）

19、在数据库的三级模式结构当中，描述数据控中全体数据的**全局**逻辑结构和特征的是（模式）

20、下面关于数据库设计的说法中正确的是（多选）（AB）
 A.信息需求表示一个组织所需要的数据及其结构
 B.处理需求表示一个组织所需要经常进行的数据处理
 C.信息需求表达了对数据库内容及结构的要求，是动态需求
 D.处理需求表达了基于数据库的数据处理需求，是静态需求

21、Armstrong公理系统的三跳推理规则是（自反性，增广性，传递性）